<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Match Builder | Periplo</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>⚡</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config = { darkMode: 'class' }; document.documentElement.classList.add('dark');</script>
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "react/jsx-runtime": "https://esm.sh/react@18.2.0/jsx-runtime",
        "lucide-react": "https://esm.sh/lucide-react@0.263.1",
        "firebase/app": "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js",
        "firebase/firestore": "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"
      }
    }
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800;900&display=swap'); 
        body { font-family: 'Plus Jakarta Sans', sans-serif; height: 100dvh; overflow: hidden; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb { background: #3f3f46; }
    </style>
</head>
<body class="bg-slate-50 dark:bg-zinc-950 transition-colors duration-300">
    <div id="root"></div>
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { initializeApp } from 'firebase/app';
        import { getFirestore, collection, addDoc, updateDoc, doc, getDoc, serverTimestamp } from 'firebase/firestore';
        import { Zap, Puzzle, Filter, CheckSquare, Square, ChevronDown, ChevronRight, Save, ArrowLeft, Loader2, Sun, Moon, ChefHat, ShoppingCart } from 'lucide-react';

        const firebaseConfig = { apiKey: "AIzaSyD4d-Kx1jQbgrKIdeOftv7BM729m7MIGPo", authDomain: "proyecto-periplo.firebaseapp.com", projectId: "proyecto-periplo", storageBucket: "proyecto-periplo.firebasestorage.app", messagingSenderId: "236795998392", appId: "1:236795998392:web:0da24b4f018611b55c844d" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // DICCIONARIO MAESTRO
        const DICTIONARY = {
            "wake up": "despertar", "shower": "ducharse", "prepare": "preparar", "take": "tomar / llevar", "pick up": "recoger", "get": "conseguir", "start": "empezar", "work": "trabajar", "help": "ayudar", "send": "enviar", "attend": "asistir", "drive": "manejar", "fill up": "llenar", "review": "revisar", "sell": "vender", "upload": "subir", "download": "descargar", "leave": "salir / dejar", "make": "hacer (crear)", "do": "hacer (acción)", "visit": "visitar", "walk": "caminar", "own": "poseer", "feed": "alimentar", "go": "ir", "see": "ver", "sleep": "dormir", "bring": "traer", "buy": "comprar", "lend": "prestar",
            "get in": "entrar", "get out": "salir", "agree": "acordar", "dance": "bailar", "arrive": "llegar", "practice": "practicar", "say": "decir", "tell": "contar / decir a", "speak": "hablar", "talk": "conversar", "rest": "descansar", "close": "cerrar", "write": "escribir", "read": "leer", "call": "llamar", "answer": "responder", "wait for": "esperar", "meet": "conocer / reunir", "check": "revisar", "find": "encontrar", "look for": "buscar", "eat": "comer", "drink": "beber", "cook": "cocinar", "clean": "limpiar", "wash": "lavar", "turn on": "encender", "turn off": "apagar", "use": "usar", "brush": "cepillar", "finish": "terminar", "know": "saber / conocer",
            "open": "abrir", "confirm": "confirmar", "continue": "continuar", "improve": "mejorar", "change": "cambiar", "break": "romper", "fix": "arreglar", "lose": "perder", "find out": "descubrir", "forget": "olvidar", "remember": "recordar", "watch": "mirar", "rain": "llover", "travel": "viajar", "teach": "enseñar", "stay": "quedarse", "move": "mudar / mover", "return": "regresar", "cancel": "cancelar", "steal": "robar", "fall": "caer", "hurt": "doler / herir", "worry": "preocupar", "trust": "confiar", "join": "unirse", "share": "compartir", "avoid": "evitar", "book": "reservar", "imagine": "imaginar", "come": "venir",
            "complain": "quejarse", "request": "solicitar", "explain": "explicar", "recommend": "recomendar", "let know": "hacer saber", "collect": "recolectar", "sign": "firmar", "promise": "prometer", "discuss": "discutir", "receive": "recibir", "deliver": "entregar", "order": "ordenar", "build": "construir", "repair": "reparar", "design": "diseñar", "manage": "gestionar", "organize": "organizar", "support": "apoyar", "follow": "seguir", "verify": "verificar", "celebrate": "celebrar", "sing": "cantar", "understand": "entender", "learn": "aprender", "listen": "escuchar", "laugh": "reír", "cry": "llorar", "borrow": "pedir prestado",
            "dream": "soñar", "complete": "completar", "report": "reportar", "solve": "resolver", "submit": "enviar", "suggest": "sugerir", "warn": "advertir", "wonder": "preguntarse", "choose": "elegir", "plan": "planear", "repeat": "repetir", "accomplish": "lograr", "relax": "relajarse", "compare": "comparar", "park": "estacionar", "plug": "enchufar", "carry": "cargar", "pay": "pagar", "switch": "intercambiar", "push": "empujar", "pull": "jalar", "show": "mostrar", "save": "ahorrar / salvar", "raise": "levantar / criar", "go down": "bajar", "increase": "aumentar", "reduce": "reducir", "hand": "entregar", "reach": "alcanzar",
            "think": "pensar", "believe": "creer", "feel": "sentir", "want": "querer", "need": "necesitar", "love": "amar", "hate": "odiar", "prefer": "preferir", "hope": "esperar", "enjoy": "disfrutar", "decide": "decidir", "allow": "permitir", "prevent": "prevenir", "protect": "proteger", "handle": "manejar", "perform": "realizar", "develop": "desarrollar", "grow": "crecer", "replace": "reemplazar", "throw": "lanzar", "catch": "atrapar", "sit": "sentarse", "stand": "ponerse de pie", "jump": "saltar", "run": "correr", "hide": "esconderse", "taste": "probar (sabor)", "smell": "oler", "touch": "tocar", "bite": "morder",
            "invite": "invitar", "accept": "aceptar", "refuse": "rechazar", "admit": "admitir", "deny": "negar", "offer": "ofrecer", "demand": "exigir", "advise": "aconsejar", "encourage": "animar", "mention": "mencionar", "describe": "describir", "identify": "identificar", "realize": "darse cuenta", "recognize": "reconocer", "suppose": "suponer", "guess": "adivinar", "measure": "medir", "weigh": "pesar", "fit": "quedar (talla)", "suit": "quedar bien", "match": "hacer juego", "fill": "llenar", "empty": "vaciar", "burn": "quemar", "freeze": "congelar", "melt": "derretir", "mix": "mezclar", "connect": "conectar", "succeed": "tener éxito", "fail": "fracasar",
            "Hire": "Contratar", "Fire": "Despedir", "Earn": "Ganar (dinero)", "Spend": "Gastar", "Invest": "Invertir", "Owe": "Deber", "Promote": "Promover", "Retire": "Jubilarse", "Resign": "Renunciar", "Operate": "Operar", "Produce": "Producir", "Manufacture": "Fabricar", "Distribute": "Distribuir", "Store": "Almacenar", "Export": "Exportar", "Import": "Importar", "Inspect": "Inspeccionar", "Negotiate": "Negociar", "Persuade": "Persuadir", "Convince": "Convencer", "Represent": "Representar", "Regulate": "Regular", "Govern": "Gobernar", "Vote": "Votar", "Resolve": "Resolver", "Cooperate": "Cooperar", "Compete": "Competir", "Win": "Ganar", "Beat": "Vencer", "Gain": "Obtener",
            "Cure": "Curar", "Heal": "Sanar", "Suffer": "Sufrir", "Bleed": "Sangrar", "Recover": "Recuperarse", "Examine": "Examinar", "Diagnose": "Diagnosticar", "Prescribe": "Recetar", "Treat": "Tratar", "Board": "Abordar", "Land": "Aterrizar", "Take off": "Despegar", "Reserve": "Reservar", "Accommodate": "Acomodar", "Check in": "Registrarse", "Check out": "Salir (hotel)", "Explore": "Explorar", "Guide": "Guiar", "Wander": "Deambular", "Escape": "Escapar", "Survive": "Sobrevivir", "Attack": "Atacar", "Defend": "Defender", "Fight": "Pelear", "Greet": "Saludar", "Introduce": "Presentar", "Appreciate": "Apreciar", "Forgive": "Perdonar", "Criticize": "Criticar", "Praise": "Elogiar",
            "What": "Qué", "Where": "Dónde", "When": "Cuándo / Cuando", "Who": "Quién", "Why": "Por qué", "Which": "Cuál", "How": "Cómo", "Whose": "De quién", "Whom": "A quién", "What time": "A qué hora", "How often": "Con qué frecuencia", "How much": "Cuánto", "How many": "Cuántos", "How long": "Cuánto tiempo",
            "For": "Por / Para", "And": "Y", "Nor": "Ni", "But": "Pero", "Or": "O", "Yet": "Sin embargo", "So": "Así que",
            "While": "Mientras", "Before": "Antes", "After": "Después", "Until": "Hasta", "Since": "Desde", "As soon as": "Tan pronto como", "Because": "Porque", "As": "Como", "If": "Si", "Unless": "A menos que", "Even if": "Incluso si", "Although": "Aunque", "Though": "Aunque (corto)", "Even though": "A pesar de que", "Whereas": "Mientras que",
            "in": "en", "on": "en (sobre/días)", "at": "en (punto/horas)", "about": "acerca de", "against": "contra", "according to": "según", "during": "durante", "so that": "para que", "instead of": "en lugar de", "then": "entonces", "that’s why": "por eso",
            "between": "entre dos", "among": "entre varios", "next to": "al lado de", "behind": "detrás", "in front of": "enfrente", "close to": "cerca de", "by": "por / junto a", "under": "debajo", "below": "abajo", "underneath": "por debajo", "over": "por encima", "above": "arriba", "across from": "cruzando", "opposite": "opuesto", "ahead": "adelante", "within": "dentro de",
            "Plenty": "Suficiente", "A lot": "Mucho", "Many": "Muchos", "Most": "La mayoría", "Several": "Varios", "Enough": "Suficiente (cantidad)", "Half": "Mitad", "Some": "Algunos", "A little": "Un poco (incontable)", "A few": "Unos pocos", "A bit": "Un poco", "A couple": "Un par", "Any": "Cualquier", "None": "Ninguno", "The whole": "Todo el",
            "always": "siempre", "usually": "usualmente", "often": "a menudo", "sometimes": "a veces", "hardly ever": "casi nunca", "never": "nunca", "now": "ahora", "today": "hoy", "yesterday": "ayer", "tomorrow": "mañana", "soon": "pronto", "later": "luego", "tonight": "esta noche",
            "my": "mi", "your": "tu / su", "his": "su (él)", "her": "su (ella)", "its": "su (eso)", "our": "nuestro", "their": "su (ellos)",
            "me": "a mí", "you": "a ti", "him": "a él", "us": "a nosotros", "them": "a ellos"
        };

        const SPECIAL_WORDS = { "WH Questions": ["What", "Where", "When", "Who", "Why", "Which", "How", "Whose", "Whom", "What time", "How often", "How much", "How many", "How long"], "Connectors & Conjunctions": ["For", "And", "Nor", "But", "Or", "Yet", "So", "While", "Before", "After", "Until", "Since", "As soon as", "Because", "As", "If", "Unless", "Even if", "Although", "Though", "Even though", "Whereas"], "Prepositions": ["in", "on", "at", "about", "against", "according to", "during", "so that", "instead of", "then", "that’s why", "between", "among", "next to", "behind", "in front of", "close to", "by", "under", "below", "underneath", "over", "above", "across from", "opposite", "ahead", "within"], "Quantifiers": ["Plenty", "A lot", "Many", "Most", "Several", "Enough", "Half", "Some", "A little", "A few", "A bit", "A couple", "Any", "None", "The whole"], "Time Indicators": ["always", "usually", "often", "sometimes", "hardly ever", "never", "now", "today", "yesterday", "tomorrow", "soon", "later", "tonight"], "Pronouns & Adjectives": ["my", "your", "his", "her", "its", "our", "their", "me", "you", "him", "us", "them"] };
        const VOCAB_PACKS = { "Pack 1 (Daily & Work)": ["wake up", "shower", "prepare", "take", "pick up", "get", "start", "work", "help", "send", "attend", "drive", "fill up", "review", "sell", "upload", "download", "leave", "make", "do", "visit", "walk", "own", "feed", "go", "see", "sleep", "bring", "buy", "lend"], "Pack 2 (Comm & Home)": ["get in", "get out", "agree", "dance", "arrive", "practice", "say", "tell", "speak", "talk", "rest", "close", "write", "read", "call", "answer", "wait for", "meet", "check", "find", "look for", "eat", "drink", "cook", "clean", "wash", "turn on", "turn off", "use", "brush", "finish", "know"], "Pack 3 (Travel & Conflict)": ["open", "confirm", "continue", "improve", "change", "break", "fix", "lose", "find out", "forget", "remember", "watch", "rain", "travel", "teach", "stay", "move", "return", "cancel", "steal", "fall", "hurt", "worry", "trust", "join", "share", "avoid", "book", "imagine", "come"], "Pack 4 (Business & Emotion)": ["complain", "request", "explain", "recommend", "let know", "collect", "sign", "promise", "discuss", "receive", "deliver", "order", "build", "repair", "design", "manage", "organize", "support", "follow", "verify", "celebrate", "sing", "understand", "learn", "listen", "laugh", "cry", "borrow"], "Pack 5 (Action & Strategy)": ["dream", "complete", "report", "solve", "submit", "suggest", "warn", "wonder", "choose", "plan", "repeat", "accomplish", "relax", "compare", "park", "plug", "carry", "pay", "switch", "push", "pull", "show", "save", "raise", "go down", "increase", "reduce", "hand", "reach"], "Pack 6 (P6/P7 Mix 1)": ["think", "believe", "feel", "want", "need", "love", "hate", "prefer", "hope", "enjoy", "decide", "allow", "prevent", "protect", "handle", "perform", "develop", "grow", "replace", "throw", "catch", "sit", "stand", "jump", "run", "hide", "taste", "smell", "touch", "bite"], "Pack 7 (P6/P7 Mix 2)": ["invite", "accept", "refuse", "admit", "deny", "offer", "demand", "advise", "encourage", "mention", "describe", "identify", "realize", "recognize", "suppose", "guess", "measure", "weigh", "fit", "suit", "match", "fill", "empty", "burn", "freeze", "melt", "mix", "connect", "succeed", "fail"], "Pack 8 (Corporate)": ["Hire", "Fire", "Earn", "Spend", "Invest", "Owe", "Promote", "Retire", "Resign", "Operate", "Produce", "Manufacture", "Distribute", "Store", "Export", "Import", "Inspect", "Negotiate", "Persuade", "Convince", "Represent", "Regulate", "Govern", "Vote", "Resolve", "Cooperate", "Compete", "Win", "Beat", "Gain"], "Pack 9 (Medical & Survival)": ["Cure", "Heal", "Suffer", "Bleed", "Recover", "Examine", "Diagnose", "Prescribe", "Treat", "Board", "Land", "Take off", "Reserve", "Accommodate", "Check in", "Check out", "Explore", "Guide", "Wander", "Escape", "Survive", "Attack", "Defend", "Fight", "Greet", "Introduce", "Appreciate", "Forgive", "Criticize", "Praise"] };

        const Dashboard = () => {
            const [gameTitle, setGameTitle] = useState("");
            const [selectedWords, setSelectedWords] = useState(new Set());
            const [isSaving, setIsSaving] = useState(false);
            const [editingId, setEditingId] = useState(null);
            const [isLoadingData, setIsLoadingData] = useState(false);

            const [expandedPacks, setExpandedPacks] = useState(new Set());
            const [expandedSpecial, setExpandedSpecial] = useState(new Set());
            const [isDarkMode, setIsDarkMode] = useState(true);

            useEffect(() => {
                const savedTheme = localStorage.getItem('themePreference');
                if (savedTheme === 'light') setIsDarkMode(false);

                const init = async () => {
                    const params = new URLSearchParams(window.location.search);
                    const editId = params.get('edit');
                    if (editId) {
                        setIsLoadingData(true);
                        try {
                            const docRef = doc(db, 'artifacts/periplo-app-v1/users/teacher_builder_001/quizzes', editId);
                            const docSnap = await getDoc(docRef);
                            if (docSnap.exists()) {
                                const data = docSnap.data();
                                setGameTitle(data.title);
                                setEditingId(editId);
                                
                                // Restablecer palabras seleccionadas
                                if (data.content && data.content.wordPool) {
                                    const wordsSet = new Set(data.content.wordPool.map(w => w.en));
                                    setSelectedWords(wordsSet);
                                }
                            } else alert("No se encontró el juego.");
                        } catch (e) { alert("Error cargando: " + e.message); } 
                        finally { setIsLoadingData(false); }
                    }
                };
                init();
            }, []);

            useEffect(() => {
                if (isDarkMode) document.documentElement.classList.add('dark');
                else document.documentElement.classList.remove('dark');
            }, [isDarkMode]);

            const toggleTheme = () => { setIsDarkMode(!isDarkMode); localStorage.setItem('themePreference', !isDarkMode ? 'dark' : 'light'); };

            const toggleWord = (word) => { const newSet = new Set(selectedWords); newSet.has(word) ? newSet.delete(word) : newSet.add(word); setSelectedWords(newSet); };
            const toggleCategoryAll = (dataObj, categoryName) => { const items = dataObj[categoryName]; const allSelected = items.every(i => selectedWords.has(i)); const newSet = new Set(selectedWords); if (allSelected) items.forEach(i => newSet.delete(i)); else items.forEach(i => newSet.add(i)); setSelectedWords(newSet); };
            const togglePackExpansion = (packName, setExpanded) => { setExpanded(prev => { const next = new Set(prev); next.has(packName) ? next.delete(packName) : next.add(packName); return next; }); };

            const saveToFirebase = async () => {
                if (!gameTitle) return alert("Ponle un título al juego");
                if (selectedWords.size < 5) return alert("Selecciona al menos 5 palabras (El tablero necesita 5 huecos llenos para funcionar).");
                
                setIsSaving(true);
                try {
                    // Mapear palabras a { id, en, es }
                    const wordPoolArray = Array.from(selectedWords).map((w, index) => ({
                        id: index + 1,
                        en: w,
                        es: DICTIONARY[w] || w
                    }));

                    const processedContent = { wordPool: wordPoolArray };

                    const params = new URLSearchParams(window.location.search);
                    const folderParam = params.get('folder');
                    const parentPath = (folderParam && folderParam !== 'undefined' && folderParam !== 'null') ? decodeURIComponent(folderParam) : '';

                    if (editingId) {
                        await updateDoc(doc(db, 'artifacts/periplo-app-v1/users/teacher_builder_001/quizzes', editingId), { title: gameTitle, content: processedContent, updatedAt: serverTimestamp() });
                    } else {
                        await addDoc(collection(db, 'artifacts', 'periplo-app-v1', 'users', 'teacher_builder_001', 'quizzes'), { title: gameTitle, type: 'MATCH', content: processedContent, createdAt: serverTimestamp(), parentPath: parentPath });
                    }
                    window.location.href = parentPath ? `index.html?folder=${encodeURIComponent(parentPath)}` : 'index.html'; 
                } catch (e) { alert("Error guardando: " + e.message); }
                finally { setIsSaving(false); }
            };

            if (isLoadingData) return <div className="h-[100dvh] flex items-center justify-center text-slate-500 font-bold"><Loader2 className="animate-spin mr-2"/> Cargando datos del juego...</div>;

            return (
                <div className="h-[100dvh] flex flex-col">
                    <div className="bg-slate-900 dark:bg-black px-4 md:px-6 py-4 flex flex-col md:flex-row justify-between items-center shrink-0 shadow-md z-10 gap-4">
                        <div className="flex items-center justify-between w-full md:w-auto">
                            <div className="flex items-center gap-4">
                                <button onClick={() => window.location.href='index.html'} className="p-2 bg-slate-800 hover:bg-slate-700 text-white rounded-xl transition-colors"><ArrowLeft size={20}/></button>
                                <h1 className="text-xl font-black tracking-tight text-white flex items-center gap-2"><Zap className="text-yellow-400 w-5 h-5"/> Match Builder</h1>
                            </div>
                            <button onClick={toggleTheme} className="p-2 text-yellow-400 md:hidden">{isDarkMode ? <Sun size={20}/> : <Moon size={20}/>}</button>
                        </div>
                        <div className="flex items-center gap-2 w-full md:w-auto justify-end">
                            <button onClick={toggleTheme} className="hidden md:block p-2 text-yellow-400 shrink-0">{isDarkMode ? <Sun size={20}/> : <Moon size={20}/>}</button>
                            <button onClick={saveToFirebase} disabled={isSaving || selectedWords.size < 5} className="w-full md:w-auto bg-green-500 hover:bg-green-600 text-white px-6 py-2.5 rounded-xl font-bold flex items-center justify-center gap-2 transition-all disabled:opacity-50">
                                {isSaving ? <Loader2 className="animate-spin" size={18}/> : <Save size={18}/>} {editingId ? "Actualizar" : "Guardar"}
                            </button>
                        </div>
                    </div>
                    
                    <div className="flex flex-1 flex-col md:flex-row overflow-hidden bg-white dark:bg-zinc-950">
                        <div className="w-full md:w-1/2 border-b md:border-b-0 md:border-r border-slate-200 dark:border-zinc-800 flex flex-col h-1/2 md:h-full bg-slate-50 dark:bg-zinc-950/50">
                            <div className="p-4 md:p-6 border-b border-slate-200 dark:border-zinc-800 bg-white dark:bg-zinc-900 shrink-0">
                                <h2 className="font-black text-slate-800 dark:text-white flex items-center gap-2 text-lg"><ChefHat className="text-orange-500"/> Diccionario de Palabras</h2>
                                <p className="text-xs text-slate-400 dark:text-zinc-500 font-medium mt-1">Selecciona los verbos o keywords para el juego (Mín. 5).</p>
                            </div>
                            <div className="flex-1 overflow-y-auto p-4 md:p-6 space-y-8 custom-scrollbar">
                                <div>
                                    <h3 className="font-black text-amber-500 uppercase tracking-widest text-xs mb-3 flex items-center gap-2"><Puzzle size={14}/> Special Words</h3>
                                    <div className="space-y-4">
                                        {Object.entries(SPECIAL_WORDS).map(([cat, words]) => { 
                                            const count = words.filter(w => selectedWords.has(w)).length; 
                                            const isOpen = expandedSpecial.has(cat); 
                                            return (
                                                <div key={cat} className={`bg-white dark:bg-zinc-900 rounded-xl border-2 transition-all ${count > 0 ? 'border-amber-400 shadow-sm' : 'border-slate-200 dark:border-zinc-800 shadow-sm'}`}>
                                                    <div className="p-3 flex items-center justify-between cursor-pointer hover:bg-slate-50 dark:hover:bg-zinc-800 transition-colors rounded-t-xl" onClick={() => togglePackExpansion(cat, setExpandedSpecial)}>
                                                        <div className="flex items-center gap-3">
                                                            <button onClick={(e) => {e.stopPropagation(); toggleCategoryAll(SPECIAL_WORDS, cat);}} className="focus:outline-none hover:scale-110 transition-transform">{count === words.length ? <CheckSquare className="text-amber-500"/> : count > 0 ? <div className="w-5 h-5 bg-amber-200 text-amber-800 rounded flex items-center justify-center font-bold text-[10px]">{count}</div> : <Square className="text-slate-300 dark:text-zinc-600"/>}</button>
                                                            <div><div className="font-bold text-slate-700 dark:text-zinc-300 text-xs uppercase">{cat}</div></div>
                                                        </div>
                                                        {isOpen ? <ChevronDown size={14} className="text-slate-400"/> : <ChevronRight size={14} className="text-slate-400"/>}
                                                    </div>
                                                    {isOpen && (
                                                        <div className="p-3 pt-0 border-t border-slate-100 dark:border-zinc-800 flex flex-wrap gap-2 mt-2 bg-slate-50/50 dark:bg-zinc-950/50 rounded-b-xl">
                                                            {words.map(w => (
                                                                <button key={w} onClick={() => toggleWord(w)} className={`text-[10px] px-2 py-1 rounded transition-colors border font-bold ${selectedWords.has(w) ? 'bg-amber-100 dark:bg-amber-900/30 text-amber-800 dark:text-amber-400 border-amber-300 dark:border-amber-700' : 'bg-white dark:bg-zinc-800 border-slate-200 dark:border-zinc-700 text-slate-500 dark:text-zinc-400 hover:border-slate-300 dark:hover:border-zinc-500'}`}>{w}</button>
                                                            ))}
                                                        </div>
                                                    )}
                                                </div>
                                            ); 
                                        })}
                                    </div>
                                </div>
                                <div>
                                    <h3 className="font-black text-emerald-500 uppercase tracking-widest text-xs mb-3 flex items-center gap-2"><Filter size={14}/> Vocab Packs</h3>
                                    <div className="space-y-4 pb-24">
                                        {Object.entries(VOCAB_PACKS).map(([pack, verbs]) => { 
                                            const count = verbs.filter(v => selectedWords.has(v)).length; 
                                            const isOpen = expandedPacks.has(pack); 
                                            return (
                                                <div key={pack} className={`bg-white dark:bg-zinc-900 rounded-xl border-2 transition-all ${count > 0 ? 'border-emerald-500 shadow-md' : 'border-slate-200 dark:border-zinc-800 shadow-sm'}`}>
                                                    <div className="p-4 flex items-center justify-between cursor-pointer hover:bg-slate-50 dark:hover:bg-zinc-800 transition-colors rounded-t-xl" onClick={() => togglePackExpansion(pack, setExpandedPacks)}>
                                                        <div className="flex items-center gap-3">
                                                            <button onClick={(e) => {e.stopPropagation(); toggleCategoryAll(VOCAB_PACKS, pack);}} className="focus:outline-none hover:scale-110 transition-transform">{count === verbs.length ? <CheckSquare className="text-emerald-600"/> : count > 0 ? <div className="w-6 h-6 bg-emerald-200 text-emerald-800 rounded flex items-center justify-center font-bold text-xs">{count}</div> : <Square className="text-slate-300 dark:text-zinc-600"/>}</button>
                                                            <div><div className="font-bold text-slate-700 dark:text-zinc-200 text-sm">{pack}</div><div className="text-[10px] text-slate-400 dark:text-zinc-500 font-bold">{verbs.length} verbs</div></div>
                                                        </div>
                                                        {isOpen ? <ChevronDown size={16} className="text-slate-400"/> : <ChevronRight size={16} className="text-slate-400"/>}
                                                    </div>
                                                    {isOpen && (
                                                        <div className="p-4 pt-0 border-t border-slate-100 dark:border-zinc-800 grid grid-cols-2 gap-2 mt-2 bg-slate-50/50 dark:bg-zinc-950/50 rounded-b-xl">
                                                            {verbs.map(v => (
                                                                <button key={v} onClick={() => toggleWord(v)} className={`text-xs px-2 py-1.5 rounded text-left transition-colors flex items-center gap-2 border ${selectedWords.has(v) ? 'bg-emerald-100 dark:bg-emerald-900/30 text-emerald-800 dark:text-emerald-400 font-bold border-emerald-200 dark:border-emerald-800' : 'bg-white dark:bg-zinc-800 border-slate-200 dark:border-zinc-700 text-slate-500 dark:text-zinc-400 hover:border-slate-300 dark:hover:border-zinc-600'}`}><div className={`w-1.5 h-1.5 rounded-full shrink-0 ${selectedWords.has(v) ? 'bg-emerald-500' : 'bg-slate-300 dark:bg-zinc-600'}`}></div> {v}</button>
                                                            ))}
                                                        </div>
                                                    )}
                                                </div>
                                            ); 
                                        })}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div className="w-full md:w-1/2 bg-white dark:bg-zinc-900 flex flex-col relative h-1/2 md:h-full">
                            <div className="p-4 md:p-6 border-b border-slate-200 dark:border-zinc-800 flex justify-between items-center shadow-sm z-10 shrink-0">
                                <div>
                                    <h3 className="font-black text-slate-800 dark:text-white flex items-center gap-2 text-lg"><ShoppingCart className="text-blue-500"/> Bolsa de Palabras</h3>
                                    <p className="text-xs text-slate-400 dark:text-zinc-500 font-medium mt-1">El juego elegirá aleatoriamente de esta lista.</p>
                                </div>
                                <span className={`px-3 py-1.5 rounded-full text-xs font-bold border shrink-0 ${selectedWords.size >= 5 ? 'bg-green-100 text-green-800 border-green-200' : 'bg-red-100 text-red-800 border-red-200 animate-pulse'}`}>{selectedWords.size} / 5</span>
                            </div>
                            
                            <div className="flex-1 p-4 md:p-6 overflow-y-auto custom-scrollbar">
                                <div className="mb-6 md:mb-8">
                                    <input value={gameTitle} onChange={e => setGameTitle(e.target.value)} className="text-2xl md:text-3xl font-black w-full border-b-2 border-dashed border-slate-300 dark:border-zinc-700 pb-2 outline-none bg-transparent dark:text-zinc-100 placeholder-slate-300 dark:placeholder-zinc-700" placeholder="Escribe el Título..."/>
                                </div>

                                {selectedWords.size === 0 ? (
                                    <div className="flex flex-col items-center justify-center text-slate-300 dark:text-zinc-600 h-48">
                                        <ShoppingCart size={48} className="mb-4 opacity-50"/>
                                        <p className="font-bold text-center">Tu bolsa está vacía.</p>
                                        <p className="text-sm text-center">El juego necesita un banco de palabras para funcionar.</p>
                                    </div>
                                ) : (
                                    <div className="grid grid-cols-2 md:grid-cols-3 gap-2 pb-24">
                                        {Array.from(selectedWords).map(word => (
                                            <div key={word} className="bg-slate-50 dark:bg-zinc-950 border border-slate-200 dark:border-zinc-800 rounded-xl p-3 flex flex-col justify-center items-center text-center">
                                                <span className="font-bold text-slate-800 dark:text-zinc-200 text-sm leading-tight">{word}</span>
                                                <span className="text-[10px] text-slate-400 dark:text-zinc-500 font-bold uppercase mt-1 leading-tight">{DICTIONARY[word] || word}</span>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<Dashboard />);
    </script>
</body>
</html>