<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connect 4 Builder | Periplo</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üèóÔ∏è</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "react/jsx-runtime": "https://esm.sh/react@18.2.0/jsx-runtime",
        "lucide-react": "https://esm.sh/lucide-react@0.263.1",
        "firebase/app": "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js",
        "firebase/firestore": "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"
      }
    }
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap'); 
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f8fafc; height: 100vh; overflow: hidden; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { initializeApp } from 'firebase/app';
        import { getFirestore, collection, addDoc, serverTimestamp } from 'firebase/firestore';
        import { Sparkles, Layers, Puzzle, Filter, CheckSquare, Square, ChevronDown, ChevronRight, Zap, Save, Edit3, Trash2, ArrowLeft, Loader2, Search, CheckCircle2, Circle } from 'lucide-react';

        const firebaseConfig = { apiKey: "AIzaSyD4d-Kx1jQbgrKIdeOftv7BM729m7MIGPo", authDomain: "proyecto-periplo.firebaseapp.com", projectId: "proyecto-periplo", storageBucket: "proyecto-periplo.firebasestorage.app", messagingSenderId: "236795998392", appId: "1:236795998392:web:0da24b4f018611b55c844d" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const SPECIAL_WORDS = { "WH Questions": ["What", "Where", "When", "Who", "Why", "Which", "How", "Whose", "Whom"], "Connectors": ["to", "from", "until", "with", "without", "in", "on", "at", "about", "against", "according to", "during", "and", "or", "but", "because", "if", "although", "while", "when", "so that", "instead of", "then", "that‚Äôs why"], "Place Indicators": ["between", "among", "next to", "behind", "in front of", "in", "on", "at", "close to", "by", "under", "below", "underneath", "over", "above", "across from", "opposite", "on the right", "on the left", "on the corner", "in the corner", "ahead", "within"], "Quantifiers": ["Plenty (of)", "A lot (of)", "Many", "Most", "Several", "Enough", "Half (of)", "Some", "A little (of)", "A few", "A bit (of)", "A couple of", "Any", "None", "The whole"], "Time Indicators": ["always", "usually", "often", "sometimes", "hardly ever", "never", "every day", "now", "right now", "at the moment", "currently", "today", "yesterday", "last night", "ago", "then", "the other day", "while", "when", "tomorrow", "next week", "soon", "later", "tonight", "if", "one day", "someday", "since", "for", "during", "until", "by"], "Possessive Adjectives": ["my", "your", "his", "her", "its", "our", "their"], "Object Pronouns": ["me", "you", "him", "her", "it", "us", "them"] };
        const VOCAB_PACKS = { "Pack 1 (Daily & Work)": ["wake up", "shower", "prepare", "take", "pick up", "get", "start", "work", "help", "send", "attend", "drive", "fill up", "review", "sell", "upload", "download", "leave", "make", "do", "visit", "walk", "own", "feed", "go", "see", "sleep", "bring", "buy", "lend"], "Pack 2 (Comm & Home)": ["get in/out", "agree", "dance", "arrive", "practice", "say", "tell", "speak", "talk", "rest", "close", "write", "read", "call", "answer", "wait for", "meet", "check", "find", "look for", "eat", "drink", "cook", "clean", "wash", "turn on/off", "use", "brush", "finish", "know"], "Pack 3 (Travel & Conflict)": ["open", "confirm", "continue", "improve", "change", "break", "fix", "lose", "find out", "forget", "remember", "watch", "rain", "travel", "teach", "stay", "move", "return", "cancel", "steal", "fall", "hurt", "worry", "trust", "join", "share", "avoid", "book", "imagine", "come"], "Pack 4 (Business & Emotion)": ["complain", "request", "explain", "recommend", "let know", "collect", "sign", "promise", "discuss", "receive", "deliver", "order", "build", "repair", "design", "manage", "organize", "support", "follow", "verify", "celebrate", "sing", "understand", "learn", "listen", "laugh", "cry", "borrow"], "Pack 5 (Action & Strategy)": ["dream", "complete", "report", "solve", "submit", "suggest", "warn", "wonder", "choose", "plan", "repeat", "accomplish", "relax", "compare", "park", "plug", "carry", "pay", "switch", "push", "pull", "show", "save", "raise", "go down", "increase", "reduce", "hand", "reach"], "Pack 6 (P6/P7 Mix 1)": ["think", "believe", "feel", "want", "need", "love", "hate", "prefer", "hope", "enjoy", "decide", "allow", "prevent", "protect", "handle", "perform", "develop", "grow", "replace", "throw", "catch", "sit", "stand", "jump", "run", "hide", "taste", "smell", "touch", "bite"], "Pack 7 (P6/P7 Mix 2)": ["invite", "accept", "refuse", "admit", "deny", "offer", "demand", "advise", "encourage", "mention", "describe", "identify", "realize", "recognize", "suppose", "guess", "measure", "weigh", "fit", "suit", "match", "fill", "empty", "burn", "freeze", "melt", "mix", "connect", "succeed", "fail"], "Pack 8 (Corporate)": ["Hire", "Fire", "Earn", "Spend", "Invest", "Owe", "Promote", "Retire", "Resign", "Operate", "Produce", "Manufacture", "Distribute", "Store", "Export", "Import", "Inspect", "Negotiate", "Persuade", "Convince", "Represent", "Regulate", "Govern", "Vote", "Resolve", "Cooperate", "Compete", "Win", "Beat", "Gain"], "Pack 9 (Medical & Survival)": ["Cure", "Heal", "Suffer", "Bleed", "Recover", "Examine", "Diagnose", "Prescribe", "Treat", "Board", "Land", "Take off", "Reserve", "Accommodate", "Check in", "Check out", "Explore", "Guide", "Wander", "Escape", "Survive", "Attack", "Defend", "Fight", "Greet", "Introduce", "Appreciate", "Forgive", "Criticize", "Praise"] };
        const GRAMMAR_LEVELS = { "BASIC": [{ id: "Modals", label: "Modal Verbs" }, { id: "SimplePresent", label: "Simple Present" }, { id: "PresentContinuous", label: "Present Continuous" }, { id: "GoingTo", label: "Going to (Future)" }], "ADVANCED": [{ id: "SimplePast", label: "Simple Past" }, { id: "PastContinuous", label: "Past Continuous" }, { id: "PresentPerfect", label: "Present Perfect" }, { id: "SecondConditional", label: "Second Conditional" }], "PRO": [{ id: "PresentPerfectPro", label: "Present Perfect" }, { id: "PastPerfect", label: "Past Perfect" }, { id: "PerfectContinuous", label: "Past/Present Perfect Cont." }, { id: "ThirdConditional", label: "Third Conditional" }] };

        const ContentEditor = ({ content, onSave, onCancel, title, setTitle }) => {
            const [editableContent, setEditableContent] = useState(content);
            const [activeTab, setActiveTab] = useState('quizzes'); 
            const handleChange = (section, index, field, value) => { const updated = { ...editableContent }; updated[section][index][field] = value; setEditableContent(updated); };
            const handleOptionChange = (quizIndex, optionIndex, value) => { const updated = { ...editableContent }; updated.quizzes[quizIndex].options[optionIndex] = value; setEditableContent(updated); };
            const handleCorrectSelection = (quizIndex, optionIndex) => { const updated = { ...editableContent }; updated.quizzes[quizIndex].correct = optionIndex; setEditableContent(updated); };

            return (
                <div className="h-screen flex flex-col bg-slate-100 p-6">
                    <div className="bg-white rounded-2xl shadow-xl border border-slate-200 overflow-hidden flex flex-col flex-1 max-w-6xl mx-auto w-full">
                        <div className="bg-slate-900 p-6 flex justify-between items-center text-white shrink-0">
                            <div><h2 className="text-2xl font-black flex items-center gap-2"><Edit3/> Editor de Contenido</h2><p className="text-slate-400 text-sm">Revisa y edita las respuestas antes de guardar.</p></div>
                            <div className="flex gap-2"><button onClick={onCancel} className="bg-slate-700 hover:bg-slate-600 px-4 py-2 rounded-xl font-bold">Cancelar</button><button onClick={() => onSave(editableContent)} className="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-xl font-bold flex items-center gap-2"><Save size={18}/> GUARDAR JUEGO</button></div>
                        </div>
                        <div className="p-6 space-y-6 overflow-hidden flex flex-col flex-1">
                            <div><label className="block text-xs font-bold text-slate-500 uppercase mb-1">T√≠tulo de la Actividad</label><input value={title} onChange={(e) => setTitle(e.target.value)} className="w-full text-xl font-bold p-3 border-2 border-slate-200 rounded-xl focus:border-indigo-500 outline-none" placeholder="Ej. Connect 4: Pack 1 Review"/></div>
                            <div className="flex gap-2 border-b border-slate-200 shrink-0">{['quizzes', 'scrambled', 'speaking'].map(tab => (<button key={tab} onClick={() => setActiveTab(tab)} className={`px-4 py-2 font-bold capitalize border-b-4 transition-all ${activeTab === tab ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-slate-400'}`}>{tab} ({editableContent[tab]?.length || 0})</button>))}</div>
                            <div className="flex-1 overflow-y-auto custom-scrollbar space-y-4 p-2 bg-slate-50 rounded-xl border border-slate-100">
                                {activeTab === 'quizzes' && editableContent.quizzes.map((item, i) => (
                                    <div key={i} className="p-4 bg-white rounded-xl border border-slate-200 shadow-sm">
                                        <div className="flex justify-between mb-2"><span className="font-bold text-slate-400">Quiz #{i+1} - Doble Espacio</span></div>
                                        <input value={item.question} onChange={(e) => handleChange('quizzes', i, 'question', e.target.value)} className="w-full p-2 mb-3 border rounded font-medium text-slate-700 text-sm bg-slate-50 focus:bg-white transition-colors"/>
                                        <div className="grid grid-cols-2 gap-2">{item.options.map((opt, optIdx) => (<div key={optIdx} className={`flex items-center gap-2 p-2 rounded border ${optIdx === item.correct ? 'bg-green-50 border-green-300' : 'bg-white border-slate-200'}`}><button onClick={() => handleCorrectSelection(i, optIdx)} className="focus:outline-none shrink-0">{optIdx === item.correct ? <CheckCircle2 className="text-green-600 w-5 h-5"/> : <Circle className="text-slate-300 w-5 h-5 hover:text-slate-400"/>}</button><input value={opt} onChange={(e) => handleOptionChange(i, optIdx, e.target.value)} className="w-full text-xs font-bold bg-transparent outline-none text-slate-700"/></div>))}</div>
                                    </div>
                                ))}
                                {activeTab === 'scrambled' && editableContent.scrambled.map((item, i) => (
                                    <div key={i} className="p-4 bg-white rounded-xl border border-slate-200 shadow-sm">
                                        <span className="font-bold text-slate-400 text-xs block mb-1">Sentence #{i+1}:</span>
                                        <input value={item.text} onChange={(e) => handleChange('scrambled', i, 'text', e.target.value)} className="w-full p-2 mb-2 border rounded font-bold text-slate-700"/>
                                        <span className="font-bold text-slate-400 text-xs block mb-1">Translation:</span>
                                        <input value={item.translation} onChange={(e) =>
