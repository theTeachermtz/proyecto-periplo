<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creador de Flashcards - Periplo v14.0 (Modelo Cl√°sico)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { font-family: sans-serif; }
        i { font-size: 1.1em; }
    </style>
</head>
<body class="bg-slate-100 text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { createRoot } = ReactDOM;

        // ==========================================
        // üö® TUS CLAVES AQU√ç üö®
        // ==========================================
        
        const googleApiKey = "AIzaSyCEkwvmCZkPe2ae0vQsR07SwBQT1RHRc4g"; 

        const pixabayApiKey = "54261518-ae514f8c15f5fdf02ac955551"; 
        const unsplashApiKey = "SQZCJjY0Bcp4ugL9zcOOjHWHOo0hV2zwM3Ixu0oa_fU"; 

        // ==========================================

        const App = () => {
            const [cards, setCards] = useState([{ id: 1, front: '', back: '', image: null }]);
            const [prompt, setPrompt] = useState('');
            const [loading, setLoading] = useState(false);
            const [errorMsg, setErrorMsg] = useState('');

            // --- IA SIN FILTROS ---
            const generate = async () => {
                if (!prompt) return alert("Escribe un tema");
                if (googleApiKey.includes("TU_CLAVE")) return alert("Falta poner la API Key en el c√≥digo");

                setLoading(true);
                setErrorMsg('');

                try {
                    // CAMBIO CLAVE: Usamos 'gemini-pro' (El modelo m√°s compatible del mundo)
                    const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${googleApiKey.trim()}`;
                    
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: `Genera una lista JSON (array de objetos con 'front' y 'back') sobre: ${prompt}. Solo JSON raw.` }] }]
                        })
                    });

                    const data = await response.json();

                    // SI GOOGLE MANDA ERROR, LO MOSTRAMOS
                    if (!response.ok) {
                        console.error("Error Google:", data);
                        throw new Error(JSON.stringify(data.error, null, 2));
                    }

                    // PROCESAR RESPUESTA
                    const rawText = data.candidates?.[0]?.content?.parts?.[0]?.text;
                    if (!rawText) throw new Error("Google respondi√≥ vac√≠o.");

                    const cleanJson = rawText.replace(/```json/g, '').replace(/```/g, '').trim();
                    const items = JSON.parse(cleanJson);

                    if (Array.isArray(items)) {
                        setCards(prev => [...prev, ...items.map(i => ({ id: Date.now() + Math.random(), front: i.front, back: i.back, image: null }))]);
                        setPrompt('');
                    } else {
                        throw new Error("La IA no gener√≥ una lista v√°lida.");
                    }

                } catch (e) {
                    setErrorMsg(e.message);
                } finally {
                    setLoading(false);
                }
            };

            // --- IM√ÅGENES (Unsplash Principal) ---
            const searchImage = async (query, id) => {
                try {
                    const res = await fetch(`https://api.unsplash.com/search/photos?query=${query}&per_page=1&client_id=${unsplashApiKey}`);
                    const data = await res.json();
                    if(data.results[0]) {
                        setCards(prev => prev.map(c => c.id === id ? { ...c, image: data.results[0].urls.small } : c));
                    } else {
                        // Fallback Pixabay
                        const res2 = await fetch(`https://pixabay.com/api/?key=${pixabayApiKey}&q=${query}&image_type=photo`);
                        const data2 = await res2.json();
                        if(data2.hits[0]) setCards(prev => prev.map(c => c.id === id ? { ...c, image: data2.hits[0].webformatURL } : c));
                    }
                } catch(e) { console.error(e); }
            };

            return (
                <div className="max-w-4xl mx-auto p-4 space-y-6">
                    {/* ZONA DE ERROR ROJA */}
                    {errorMsg && (
                        <div className="bg-red-100 border-2 border-red-500 text-red-900 p-4 rounded-xl font-mono text-xs whitespace-pre-wrap overflow-auto">
                            <strong>‚ùå ERROR (Copia y pega):</strong><br/>
                            {errorMsg}
                        </div>
                    )}

                    <div className="bg-white p-4 rounded-xl shadow-sm border border-slate-200 flex gap-2">
                        <input value={prompt} onChange={e => setPrompt(e.target.value)} placeholder="Ej: Comida r√°pida..." className="flex-1 outline-none font-bold text-lg"/>
                        <button onClick={generate} disabled={loading} className="bg-blue-600 text-white px-6 rounded-lg font-bold hover:bg-blue-700">
                            {loading ? <i className="fa-solid fa-spinner fa-spin"></i> : 'Generar'}
                        </button>
                    </div>

                    <div className="bg-white rounded-xl shadow-sm border border-slate-200 divide-y">
                        {cards.map((c, i) => (
                            <div key={c.id} className="p-4 grid grid-cols-12 gap-4 items-center">
                                <div className="col-span-1 font-bold text-slate-300 text-center">{i+1}</div>
                                <div className="col-span-4"><input value={c.front} onChange={e => setCards(prev => prev.map(x => x.id === c.id ? {...x, front: e.target.value} : x))} className="w-full font-bold outline-none border-b border-transparent focus:border-blue-500" placeholder="Ingl√©s"/></div>
                                <div className="col-span-2 flex justify-center">
                                    {c.image ? <img src={c.image} className="w-12 h-12 rounded-lg object-cover bg-slate-100"/> : 
                                    <button onClick={() => searchImage(c.front, c.id)} className="w-12 h-12 rounded-lg border-2 border-dashed border-slate-300 text-slate-300 hover:text-blue-500 hover:border-blue-500"><i className="fa-solid fa-image"></i></button>}
                                </div>
                                <div className="col-span-4"><input value={c.back} onChange={e => setCards(prev => prev.map(x => x.id === c.id ? {...x, back: e.target.value} : x))} className="w-full font-bold outline-none border-b border-transparent focus:border-pink-500" placeholder="Espa√±ol"/></div>
                                <div className="col-span-1 text-right"><button onClick={() => setCards(prev => prev.filter(x => x.id !== c.id))} className="text-slate-300 hover:text-red-500"><i className="fa-solid fa-trash"></i></button></div>
                            </div>
                        ))}
                    </div>
                    <button onClick={() => setCards([...cards, { id: Date.now(), front: '', back: '', image: null }])} className="w-full py-3 bg-slate-200 rounded-xl font-bold text-slate-500 hover:bg-slate-300">A√±adir Fila</button>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
