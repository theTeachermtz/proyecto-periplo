<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Directorio de Alumnos | Periplo</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŽ“</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = { darkMode: 'class' };
        document.documentElement.classList.add('dark');
    </script>
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "react/jsx-runtime": "https://esm.sh/react@18.2.0/jsx-runtime",
        "lucide-react": "https://esm.sh/lucide-react@0.263.1",
        "firebase/app": "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js",
        "firebase/firestore": "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"
      }
    }
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800;900&display=swap'); 
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #09090b; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 4px; }
    </style>
</head>
<body class="bg-slate-50 dark:bg-zinc-950 text-slate-800 dark:text-zinc-100 transition-colors duration-300">
    <div id="root"></div>
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { initializeApp } from 'firebase/app';
        import { getFirestore, collection, onSnapshot, addDoc, deleteDoc, doc, serverTimestamp, setDoc } from 'firebase/firestore';
        import { Users, Link as LinkIcon, Plus, Trash2, ArrowLeft, Sun, Moon, CheckCircle2, UserPlus, Copy } from 'lucide-react';

        const firebaseConfig = { apiKey: "AIzaSyD4d-Kx1jQbgrKIdeOftv7BM729m7MIGPo", authDomain: "proyecto-periplo.firebaseapp.com", projectId: "proyecto-periplo", storageBucket: "proyecto-periplo.firebasestorage.app", messagingSenderId: "236795998392", appId: "1:236795998392:web:0da24b4f018611b55c844d" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Tu lista inicial
        const INITIAL_STUDENTS = ["TÃ©llez", "Josue", "Criis", "Monsivais", "Fabiola", "Fabian", "Dayanhi", "Wendy", "Citlalli", "Nayeli", "Paola", "Tucho", "Victor", "Cinthia"];

        const StudentManager = () => {
            const [students, setStudents] = useState([]);
            const [newStudentName, setNewStudentName] = useState('');
            const [copiedId, setCopiedId] = useState(null);
            const [isDarkMode, setIsDarkMode] = useState(true);

            useEffect(() => {
                const savedTheme = localStorage.getItem('themePreference');
                if (savedTheme === 'light') setIsDarkMode(false);
                
                const unsubscribe = onSnapshot(collection(db, 'artifacts', 'periplo-app-v1', 'students'), (snapshot) => {
                    const loaded = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    // Ordenar alfabÃ©ticamente
                    loaded.sort((a, b) => a.name.localeCompare(b.name));
                    setStudents(loaded);
                });
                return () => unsubscribe();
            }, []);

            useEffect(() => { document.documentElement.classList.toggle('dark', isDarkMode); }, [isDarkMode]);
            const toggleTheme = () => { setIsDarkMode(!isDarkMode); localStorage.setItem('themePreference', !isDarkMode ? 'dark' : 'light'); };

            const handleAddStudent = async (e) => {
                e.preventDefault();
                if (!newStudentName.trim()) return;
                try {
                    await addDoc(collection(db, 'artifacts', 'periplo-app-v1', 'students'), { name: newStudentName.trim(), createdAt: serverTimestamp() });
                    setNewStudentName('');
                } catch (error) { alert("Error al agregar: " + error.message); }
            };

            const handleDeleteStudent = async (id, name) => {
                if (confirm(`Â¿EstÃ¡s seguro de eliminar a ${name} de tu base de datos?`)) {
                    try { await deleteDoc(doc(db, 'artifacts', 'periplo-app-v1', 'students', id)); } 
                    catch (error) { alert("Error al eliminar: " + error.message); }
                }
            };

            const copyLink = (name, id) => {
                // Genera el link apuntando al schedule de alumnos
                const link = `${window.location.origin}${window.location.pathname.replace('students.html', '')}schedule.html?student=${encodeURIComponent(name)}`;
                navigator.clipboard.writeText(link);
                setCopiedId(id);
                setTimeout(() => setCopiedId(null), 2000);
            };

            const loadInitialStudents = async () => {
                if (confirm("Â¿Cargar la lista inicial de 14 alumnos?")) {
                    for (const name of INITIAL_STUDENTS) {
                        const exists = students.some(s => s.name.toLowerCase() === name.toLowerCase());
                        if (!exists) await addDoc(collection(db, 'artifacts', 'periplo-app-v1', 'students'), { name: name, createdAt: serverTimestamp() });
                    }
                }
            };

            return (
                <div className="min-h-screen bg-slate-50 dark:bg-zinc-950 transition-colors duration-300">
                    <header className="bg-white dark:bg-zinc-900 shadow-sm border-b border-slate-200 dark:border-zinc-800 sticky top-0 z-40">
                        <div className="max-w-5xl mx-auto px-4 sm:px-6 py-4 flex items-center justify-between">
                            <div className="flex items-center gap-3">
                                <button onClick={() => window.location.href='index.html'} className="p-2 hover:bg-slate-100 dark:hover:bg-zinc-800 rounded-xl transition-colors"><ArrowLeft size={20}/></button>
                                <div className="bg-indigo-500 p-2 rounded-lg text-white shadow-md"><Users size={20}/></div>
                                <div>
                                    <h1 className="text-xl font-black text-slate-800 dark:text-white leading-none">ALUMNOS</h1>
                                    <p className="text-[10px] font-bold text-slate-400 dark:text-zinc-500 uppercase tracking-widest mt-1">Generador de Enlaces</p>
                                </div>
                            </div>
                            <div className="flex items-center gap-3">
                                <div className="bg-slate-100 dark:bg-zinc-800 px-3 py-1.5 rounded-lg text-xs font-bold text-slate-500 dark:text-zinc-400 hidden sm:block">
                                    Total: {students.length}
                                </div>
                                <button onClick={toggleTheme} className="p-2 rounded-full bg-slate-100 dark:bg-zinc-800 text-slate-600 dark:text-amber-400 hover:bg-slate-200 dark:hover:bg-zinc-700 transition-colors">
                                    {isDarkMode ? <Sun size={18} /> : <Moon size={18} />}
                                </button>
                            </div>
                        </div>
                    </header>

                    <main className="max-w-5xl mx-auto px-4 sm:px-6 py-8">
                        <div className="bg-white dark:bg-zinc-900 rounded-3xl shadow-xl border border-slate-200 dark:border-zinc-800 p-6 sm:p-8 mb-8">
                            <h2 className="text-lg font-black mb-4 flex items-center gap-2 text-slate-800 dark:text-white"><UserPlus className="text-indigo-500"/> Registrar Nuevo Alumno</h2>
                            <form onSubmit={handleAddStudent} className="flex gap-3">
                                <input type="text" value={newStudentName} onChange={e => setNewStudentName(e.target.value)} placeholder="Nombre del alumno..." className="flex-1 bg-slate-50 dark:bg-zinc-950 border-2 border-slate-200 dark:border-zinc-800 rounded-xl px-4 py-3 font-bold outline-none focus:border-indigo-500 dark:text-white transition-colors"/>
                                <button type="submit" disabled={!newStudentName.trim()} className="bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 text-white px-6 py-3 rounded-xl font-black uppercase tracking-widest shadow-lg transition-colors flex items-center gap-2"><Plus size={18}/> <span className="hidden sm:inline">Agregar</span></button>
                            </form>
                        </div>

                        {students.length === 0 ? (
                            <div className="text-center py-12 bg-white dark:bg-zinc-900 rounded-3xl border border-slate-200 dark:border-zinc-800 border-dashed">
                                <Users size={48} className="mx-auto text-slate-300 dark:text-zinc-700 mb-4"/>
                                <h3 className="text-xl font-bold text-slate-500 dark:text-zinc-500 mb-6">Tu base de datos estÃ¡ vacÃ­a.</h3>
                                <button onClick={loadInitialStudents} className="bg-slate-800 dark:bg-white text-white dark:text-slate-900 px-6 py-3 rounded-xl font-black uppercase tracking-widest shadow-lg hover:scale-105 transition-transform">Cargar Mis 14 Alumnos Iniciales</button>
                            </div>
                        ) : (
                            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                                {students.map(student => (
                                    <div key={student.id} className="bg-white dark:bg-zinc-900 rounded-2xl p-5 border border-slate-200 dark:border-zinc-800 shadow-sm flex flex-col justify-between group hover:shadow-md transition-shadow">
                                        <div className="flex justify-between items-start mb-4">
                                            <h3 className="font-black text-lg text-slate-800 dark:text-zinc-100 truncate pr-2" title={student.name}>{student.name}</h3>
                                            <button onClick={() => handleDeleteStudent(student.id, student.name)} className="text-slate-300 dark:text-zinc-700 hover:text-rose-500 dark:hover:text-rose-500 transition-colors"><Trash2 size={16}/></button>
                                        </div>
                                        <button onClick={() => copyLink(student.name, student.id)} className={`w-full py-3 rounded-xl font-bold text-sm flex items-center justify-center gap-2 transition-all border-2 ${copiedId === student.id ? 'bg-emerald-50 dark:bg-emerald-900/30 border-emerald-400 text-emerald-600 dark:text-emerald-400' : 'bg-slate-50 dark:bg-zinc-950 border-slate-200 dark:border-zinc-800 text-slate-600 dark:text-zinc-300 hover:border-indigo-500 hover:text-indigo-500'}`}>
                                            {copiedId === student.id ? <><CheckCircle2 size={16}/> Enlace Copiado</> : <><LinkIcon size={16}/> Copiar Link Agenda</>}
                                        </button>
                                    </div>
                                ))}
                            </div>
                        )}
                    </main>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<StudentManager />);
    </script>
</body>
</html>