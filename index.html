<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Periplo - Teacher Hub v19.5</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>游</text></svg>">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = { darkMode: 'class' };
        if (window.location.search.includes('undefined') || window.location.search.includes('null')) {
            window.history.replaceState({}, document.title, window.location.pathname);
        }
    </script>

    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "react/jsx-runtime": "https://esm.sh/react@18.2.0/jsx-runtime",
        "lucide-react": "https://esm.sh/lucide-react@0.263.1",
        "firebase/app": "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js",
        "firebase/auth": "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js",
        "firebase/firestore": "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"
      }
    }
    </script>
    <script type="module" src="https://esm.sh/run"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;700;800;900&display=swap'); 
        html, body { font-family: 'Plus Jakarta Sans', sans-serif; overflow-x: hidden; background-color: #09090b; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .drag-over-breadcrumb { background-color: rgba(99, 102, 241, 0.2); border-radius: 0.5rem; padding: 0 0.5rem; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, Component } from 'react';
        import { createRoot } from 'react-dom/client';
        import { initializeApp } from 'firebase/app';
        import { getFirestore, collection, addDoc, query, where, onSnapshot, serverTimestamp, doc, deleteDoc, updateDoc } from 'firebase/firestore';
        import { 
            Plus, Folder, X, LayoutGrid, Puzzle, Grid, ArrowLeft, Trash2, Copy, 
            Edit2, AlertTriangle, Map as MapIcon, Gamepad2, BookOpen, Calendar, Users, Sun, Moon, Zap, Dices
        } from 'lucide-react';

        const firebaseConfig = { apiKey: "AIzaSyD4d-Kx1jQbgrKIdeOftv7BM729m7MIGPo", authDomain: "proyecto-periplo.firebaseapp.com", projectId: "proyecto-periplo", storageBucket: "proyecto-periplo.firebasestorage.app", messagingSenderId: "236795998392", appId: "1:236795998392:web:0da24b4f018611b55c844d" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const appId = 'periplo-app-v1';

        class ErrorBoundary extends Component {
            constructor(props) { super(props); this.state = { hasError: false }; }
            static getDerivedStateFromError(error) { return { hasError: true }; }
            render() {
                if (this.state.hasError) return (
                    <div className="h-screen flex flex-col items-center justify-center p-8 text-center bg-slate-50 dark:bg-zinc-950 text-slate-800 dark:text-zinc-100">
                        <AlertTriangle size={48} className="text-rose-500 mb-4"/>
                        <h2 className="text-xl font-bold mb-2">Algo sali칩 mal</h2>
                        <button onClick={() => window.location.reload()} className="bg-slate-900 dark:bg-white text-white dark:text-zinc-900 px-6 py-3 rounded-xl font-bold">Recargar</button>
                    </div>
                );
                return this.props.children;
            }
        }

        const GAME_TYPES = [
            { id: 'FLASHCARDS', name: 'Flashcards', icon: LayoutGrid, color: 'bg-gradient-to-br from-indigo-500 to-purple-600', isWordGame: true, desc: 'Repaso con im치genes' }, 
            { id: 'ANAGRAM', name: 'Anagrama', icon: Puzzle, color: 'bg-gradient-to-br from-pink-500 to-rose-500', isWordGame: true, desc: 'Ordena las letras' },
            { id: 'CROSSWORD', name: 'Crucigrama', icon: Grid, color: 'bg-gradient-to-br from-emerald-400 to-teal-600', isWordGame: true, desc: 'Cruza tus palabras' },
            { id: 'CONNECT4', name: 'Connect 4', icon: Gamepad2, color: 'bg-gradient-to-br from-orange-400 to-amber-500', isWordGame: false, desc: 'Estrategia y Gram치tica' },
            { id: 'READING', name: 'Reading Builder', icon: BookOpen, color: 'bg-gradient-to-br from-cyan-500 to-blue-600', isWordGame: false, desc: 'Lecturas con IA y Huecos' },
            { id: 'MATCH', name: 'Match Madness', icon: Zap, color: 'bg-gradient-to-br from-yellow-400 to-red-500', isWordGame: false, desc: 'Velocidad y Reflejos' },
            { id: 'UNO', name: 'UNO Gramatical', icon: Dices, color: 'bg-gradient-to-br from-sky-400 to-blue-500', isWordGame: false, desc: 'Juego de Cartas Multijugador' }, // <-- AQU칈 SE AGREGA UNO
        ];

        const TOOL_TYPES = [
            { id: 'CITYMAP', name: 'City Map', icon: MapIcon, color: 'bg-slate-800', file: 'citymap.html', desc: 'Pr치ctica de direcciones' },
        ];

        const FOLDER_PALETTE = [
            'bg-slate-200 text-slate-800 dark:bg-slate-800 dark:text-slate-200', 
            'bg-rose-200 text-rose-900 dark:bg-rose-900/60 dark:text-rose-200', 
            'bg-amber-200 text-amber-900 dark:bg-amber-900/60 dark:text-amber-200', 
            'bg-emerald-200 text-emerald-900 dark:bg-emerald-900/60 dark:text-emerald-200', 
            'bg-sky-200 text-sky-900 dark:bg-sky-900/60 dark:text-sky-200', 
            'bg-indigo-200 text-indigo-900 dark:bg-indigo-900/60 dark:text-indigo-200', 
            'bg-fuchsia-200 text-fuchsia-900 dark:bg-fuchsia-900/60 dark:text-fuchsia-200'
        ];

        function Dashboard() {
            const user = { uid: "teacher_builder_001" };
            const [path, setPath] = useState([]);
            const [userFolders, setUserFolders] = useState([]);
            const [userQuizzes, setUserQuizzes] = useState([]);
            const [modals, setModals] = useState({ folder: false, activity: false });
            
            const [editingFolder, setEditingFolder] = useState(null);
            const [folderForm, setFolderForm] = useState({ name: '', colorClass: FOLDER_PALETTE[0] });

            const [isDarkMode, setIsDarkMode] = useState(true);

            useEffect(() => {
                const savedTheme = localStorage.getItem('themePreference');
                if (savedTheme === 'light') setIsDarkMode(false);
                else setIsDarkMode(true);

                const params = new URLSearchParams(window.location.search);
                const folderParam = params.get('folder');
                if (folderParam && folderParam !== 'undefined' && folderParam !== 'null') setPath(decodeURIComponent(folderParam).split('/'));
            }, []);

            useEffect(() => {
                if (isDarkMode) document.documentElement.classList.add('dark');
                else document.documentElement.classList.remove('dark');
            }, [isDarkMode]);

            useEffect(() => {
                const currentPath = path.join('/');
                const qF = query(collection(db, 'artifacts', appId, 'users', user.uid, 'folders'), where('parentPath', '==', currentPath));
                const unsubF = onSnapshot(qF, (s) => setUserFolders(s.docs.map(d => ({id: d.id, ...d.data()}))));
                const qQ = query(collection(db, 'artifacts', appId, 'users', user.uid, 'quizzes'), where('parentPath', '==', currentPath));
                const unsubQ = onSnapshot(qQ, (s) => setUserQuizzes(s.docs.map(d => ({id: d.id, ...d.data()}))));
                return () => { unsubF(); unsubQ(); };
            }, [path]);

            const toggleTheme = () => { 
                setIsDarkMode(!isDarkMode); 
                localStorage.setItem('themePreference', !isDarkMode ? 'dark' : 'light'); 
            };

            const navigateTo = (newPath) => {
                setPath(newPath);
                const url = new URL(window.location);
                if (newPath.length > 0) url.searchParams.set('folder', newPath.join('/')); else url.searchParams.delete('folder');
                window.history.pushState({}, '', url);
            };

            const openFolderModal = (folder = null) => {
                if (folder) {
                    setEditingFolder(folder);
                    setFolderForm({ name: folder.name, colorClass: folder.colorClass || FOLDER_PALETTE[0] });
                } else {
                    setEditingFolder(null);
                    setFolderForm({ name: '', colorClass: FOLDER_PALETTE[0] });
                }
                setModals({...modals, folder: true});
            };

            const saveFolder = async () => {
                if (!folderForm.name.trim()) return;
                try {
                    if (editingFolder) {
                        await updateDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'folders', editingFolder.id), { 
                            name: folderForm.name.trim(), colorClass: folderForm.colorClass 
                        });
                    } else {
                        await addDoc(collection(db, 'artifacts', appId, 'users', user.uid, 'folders'), { 
                            name: folderForm.name.trim(), colorClass: folderForm.colorClass, parentPath: path.join('/'), createdAt: serverTimestamp() 
                        });
                    }
                    setModals({...modals, folder: false});
                } catch(e) { alert(e.message); }
            };

            const duplicateFolder = async (e, folder) => {
                e.preventDefault(); e.stopPropagation();
                try {
                    await addDoc(collection(db, 'artifacts', appId, 'users', user.uid, 'folders'), { 
                        name: `${folder.name} (Copia)`, colorClass: folder.colorClass, parentPath: folder.parentPath, createdAt: serverTimestamp() 
                    });
                } catch(err) { alert(err.message); }
            };

            const deleteFolder = async (e, id) => {
                e.preventDefault(); e.stopPropagation();
                if(confirm("쮼liminar carpeta?")) await deleteDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'folders', id));
            };

            const handleActivityClick = (e, gameType) => {
                e.preventDefault();
                const encodedFolder = encodeURIComponent(path.join('/'));
                if (gameType.id === 'CONNECT4') window.location.href = `dashboard-connect4.html?folder=${encodedFolder}`;
                else if (gameType.id === 'READING') window.location.href = `dashboard-reading.html?folder=${encodedFolder}`;
                else if (gameType.id === 'MATCH') window.location.href = `dashboard-match.html?folder=${encodedFolder}`;
                else if (gameType.id === 'UNO') window.location.href = `dashboard-uno.html?folder=${encodedFolder}`; // <-- AQU칈 CONECTAMOS EL DASHBOARD
                else window.location.href = `dashboard.html?folderId=${encodedFolder}&type=${gameType.id}`;
            };

            const getPlayLink = (q) => {
                if (q.type === 'CONNECT4') return `connect4.html?id=${q.id}`;
                if (q.type === 'READING') return `reading.html?id=${q.id}`;
                if (q.type === 'MATCH') return `match.html?id=${q.id}`;
                if (q.type === 'UNO') return `uno.html?id=${q.id}`; // <-- AQU칈 CONECTAMOS EL JUEGO DEL ALUMNO
                return `activity.html?id=${q.id}`;
            };

            const handleCardClick = (e, q) => {
                if (e.target.closest('button')) return; 
                const link = getPlayLink(q);
                if (e.button === 1 || e.ctrlKey || e.metaKey) window.open(link, '_blank');
                else if (e.button === 0) window.location.href = link;
            };

            const handleEditActivity = (e, q) => {
                e.preventDefault(); e.stopPropagation();
                const encodedFolder = encodeURIComponent(path.join('/'));
                if (q.type === 'CONNECT4') window.location.href = `dashboard-connect4.html?edit=${q.id}&folder=${encodedFolder}`;
                else if (q.type === 'READING') window.location.href = `dashboard-reading.html?edit=${q.id}&folder=${encodedFolder}`;
                else if (q.type === 'MATCH') window.location.href = `dashboard-match.html?edit=${q.id}&folder=${encodedFolder}`;
                else if (q.type === 'UNO') window.location.href = `dashboard-uno.html?edit=${q.id}&folder=${encodedFolder}`; // <-- Y AQU칈 EL MODO EDITAR
                else alert("Editor no disponible en esta versi칩n para este juego.");
            };

            const handleDeleteActivity = async (e, id) => {
                e.preventDefault(); e.stopPropagation();
                if(confirm("쮼st치s seguro de eliminar esta actividad?")) await deleteDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'quizzes', id));
            };

            const handleDragStart = (e, id, type) => { 
                e.dataTransfer.setData('itemId', id); 
                e.dataTransfer.setData('itemType', type); 
            };

            const handleDropOnTarget = async (e, newParentPath) => {
                e.preventDefault();
                e.currentTarget.classList.remove('drag-over-breadcrumb');
                const itemId = e.dataTransfer.getData('itemId');
                const itemType = e.dataTransfer.getData('itemType');
                if (!itemId) return;
                try { 
                    if (itemType === 'quiz') await updateDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'quizzes', itemId), { parentPath: newParentPath }); 
                    else if (itemType === 'folder') await updateDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'folders', itemId), { parentPath: newParentPath });
                } 
                catch (err) { alert(err.message); }
            };

            return (
                <div className="min-h-screen bg-slate-50 dark:bg-zinc-950 text-slate-800 dark:text-zinc-100 transition-colors duration-300">
                    <div className="max-w-7xl mx-auto p-4 md:p-6 fade-in">
                        
                        <div className="bg-white dark:bg-zinc-900 p-4 rounded-2xl shadow-sm border border-slate-200 dark:border-zinc-800 mb-6 flex flex-col md:flex-row gap-4 justify-between items-center relative z-20 transition-colors w-full">
                            <div className="flex items-center justify-between w-full md:w-auto">
                                <div className="flex items-center gap-3">
                                    {path.length > 0 && <button onClick={() => navigateTo(path.slice(0, -1))} className="p-2 hover:bg-slate-100 dark:hover:bg-zinc-800 rounded-xl text-slate-400 dark:text-zinc-400 hover:text-indigo-600 dark:hover:text-indigo-400 transition-all"><ArrowLeft size={20}/></button>}
                                    <h1 className="text-xl font-black flex items-center gap-2 tracking-tight text-indigo-600 dark:text-indigo-400 uppercase italic">PERIPLO <span className="text-[10px] not-italic bg-indigo-100 dark:bg-indigo-900/50 dark:border-indigo-700 px-2 rounded-full border border-indigo-200">v19.5</span></h1>
                                </div>
                                <button onClick={toggleTheme} className="p-2 rounded-full bg-slate-100 dark:bg-zinc-800 text-slate-600 dark:text-amber-400 hover:bg-slate-200 dark:hover:bg-zinc-700 transition-colors md:hidden">
                                    {isDarkMode ? <Sun size={20}/> : <Moon size={20}/>}
                                </button>
                            </div>
                            
                            <div className="grid grid-cols-2 md:flex md:flex-row md:items-center md:justify-end gap-2 w-full md:w-auto">
                                <a href="students.html" className="justify-center bg-white dark:bg-zinc-800 border-2 border-indigo-100 dark:border-zinc-700 text-indigo-600 dark:text-indigo-400 px-3 py-2.5 rounded-xl font-bold flex gap-2 text-xs md:text-sm items-center hover:bg-indigo-50 dark:hover:bg-zinc-700"><Users size={16}/> Alumnos</a>
                                
                                <a href="dashboard-schedule.html" className="justify-center bg-emerald-500 hover:bg-emerald-600 dark:bg-emerald-600 dark:hover:bg-emerald-500 text-white px-3 py-2.5 rounded-xl font-bold flex gap-2 text-xs md:text-sm items-center shadow-md shadow-emerald-200 dark:shadow-emerald-900/20"><Calendar size={16}/> Agenda</a>
                                
                                <div className="hidden md:block w-px h-8 bg-slate-200 dark:bg-zinc-800 mx-1"></div>
                                
                                <button onClick={() => openFolderModal()} className="justify-center bg-slate-50 dark:bg-zinc-800 text-slate-600 dark:text-zinc-300 px-3 py-2.5 rounded-xl font-bold flex gap-2 hover:bg-slate-100 dark:hover:bg-zinc-700 border border-slate-200 dark:border-zinc-700 transition-all text-xs md:text-sm items-center"><Plus size={16}/> Carpeta</button>
                                <button onClick={() => setModals({...modals, activity: true})} className="justify-center bg-indigo-600 dark:bg-indigo-500 text-white px-3 py-2.5 md:px-5 rounded-xl font-bold flex gap-2 hover:bg-indigo-700 dark:hover:bg-indigo-600 shadow-lg shadow-indigo-200 dark:shadow-none transition-all text-xs md:text-sm items-center"><Plus size={16}/> Actividad</button>
                                
                                <button onClick={toggleTheme} className="hidden md:block p-2 ml-2 rounded-full bg-slate-100 dark:bg-zinc-800 text-slate-600 dark:text-amber-400 hover:bg-slate-200 dark:hover:bg-zinc-700 transition-colors">
                                    {isDarkMode ? <Sun size={20}/> : <Moon size={20}/>}
                                </button>
                            </div>
                        </div>

                        <div className="flex gap-2 mb-6 text-xs font-bold text-slate-400 dark:text-zinc-500 overflow-x-auto pb-2 uppercase tracking-widest items-center">
                            <span 
                                onDragOver={e => { e.preventDefault(); e.currentTarget.classList.add('drag-over-breadcrumb'); }}
                                onDragLeave={e => e.currentTarget.classList.remove('drag-over-breadcrumb')}
                                onDrop={e => handleDropOnTarget(e, "")}
                                onClick={() => navigateTo([])} 
                                className={`cursor-pointer hover:text-indigo-600 dark:hover:text-indigo-400 transition-colors py-1 ${path.length===0?"text-indigo-600 dark:text-indigo-400":""}`}
                            >
                                INICIO
                            </span>
                            {path.map((f, i) => {
                                const targetPath = path.slice(0, i+1).join('/');
                                return (
                                    <React.Fragment key={i}>
                                        <span className="opacity-50">/</span>
                                        <span 
                                            onDragOver={e => { e.preventDefault(); e.currentTarget.classList.add('drag-over-breadcrumb'); }}
                                            onDragLeave={e => e.currentTarget.classList.remove('drag-over-breadcrumb')}
                                            onDrop={e => handleDropOnTarget(e, targetPath)}
                                            onClick={() => navigateTo(path.slice(0, i+1))} 
                                            className="cursor-pointer hover:text-indigo-600 dark:hover:text-indigo-400 transition-colors text-slate-600 dark:text-zinc-300 py-1"
                                        >
                                            {f}
                                        </span>
                                    </React.Fragment>
                                )
                            })}
                        </div>

                        <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3 md:gap-5">
                            {userFolders.map((f) => (
                                <div 
                                    key={f.id} 
                                    onClick={(e) => { if(e.button === 0 && !e.ctrlKey && !e.metaKey) { navigateTo([...path, f.name]); } }}
                                    draggable
                                    onDragStart={e => handleDragStart(e, f.id, 'folder')}
                                    onDragOver={e => e.preventDefault()}
                                    onDrop={e => handleDropOnTarget(e, path.length > 0 ? `${path.join('/')}/${f.name}` : f.name)}
                                    className={`relative h-24 sm:h-auto sm:aspect-[4/3] ${f.colorClass || FOLDER_PALETTE[0]} border border-transparent rounded-3xl flex flex-row sm:flex-col items-center justify-start sm:justify-center gap-4 sm:gap-3 px-6 sm:px-0 shadow-sm hover:scale-[1.02] hover:shadow-lg transition-all group cursor-pointer`}
                                >
                                    <div className="absolute top-2 right-2 flex gap-1 opacity-100 sm:opacity-0 group-hover:opacity-100 transition-opacity z-10">
                                        <button onClick={(e) => { e.preventDefault(); e.stopPropagation(); openFolderModal(f); }} className="p-1.5 bg-white/50 dark:bg-black/30 backdrop-blur rounded-full hover:bg-white dark:hover:bg-black/50 transition-colors"><Edit2 size={12}/></button>
                                        <button onClick={(e) => duplicateFolder(e, f)} className="p-1.5 bg-white/50 dark:bg-black/30 backdrop-blur rounded-full hover:bg-white dark:hover:bg-black/50 transition-colors"><Copy size={12}/></button>
                                        <button onClick={(e) => deleteFolder(e, f.id)} className="p-1.5 bg-white/50 dark:bg-black/30 backdrop-blur rounded-full hover:bg-rose-500 hover:text-white transition-colors"><Trash2 size={12}/></button>
                                    </div>
                                    <Folder size={36} className="opacity-80 shrink-0"/>
                                    <span className="font-black text-[14px] sm:text-[12px] text-left sm:text-center pr-12 sm:pr-4 sm:px-4 uppercase tracking-wide truncate w-full">{f.name}</span>
                                </div>
                            ))}

                            {userQuizzes.map((q) => {
                                const info = GAME_TYPES.find(g => g.id === q.type) || GAME_TYPES[0];
                                return (
                                    <div 
                                        key={q.id} 
                                        onMouseUp={(e) => handleCardClick(e, q)}
                                        draggable
                                        onDragStart={e => handleDragStart(e, q.id, 'quiz')}
                                        className="h-28 sm:h-auto sm:aspect-[4/3] bg-white dark:bg-zinc-900 rounded-3xl shadow-sm border border-slate-200 dark:border-zinc-800 flex flex-row sm:flex-col overflow-hidden group hover:shadow-xl hover:-translate-y-1 transition-all cursor-pointer relative"
                                    >
                                        <div className="absolute top-2 right-2 flex gap-1 opacity-100 sm:opacity-0 group-hover:opacity-100 transition-opacity z-10">
                                            <button onClick={(e) => handleEditActivity(e, q)} className="p-1.5 bg-white/90 dark:bg-zinc-800/90 backdrop-blur rounded-full text-slate-400 hover:text-blue-600 dark:hover:text-blue-400 shadow-sm transition-colors"><Edit2 size={14}/></button>
                                            <button onClick={(e) => handleDeleteActivity(e, q.id)} className="p-1.5 bg-white/90 dark:bg-zinc-800/90 backdrop-blur rounded-full text-slate-400 hover:text-red-600 dark:hover:text-red-400 shadow-sm transition-colors"><Trash2 size={14}/></button>
                                        </div>
                                        <div className={`w-28 sm:w-full sm:h-1/2 ${info.color} flex items-center justify-center text-white shrink-0`}><info.icon size={28} /></div>
                                        <div className="p-4 sm:p-4 flex-1 flex flex-col justify-center sm:justify-between text-slate-700 dark:text-zinc-200 overflow-hidden w-full">
                                            <div className="font-bold text-sm sm:text-sm leading-tight pr-12 sm:pr-0 truncate sm:whitespace-normal sm:line-clamp-2">{q.title}</div>
                                            <div className="text-[10px] sm:text-[9px] text-slate-400 dark:text-zinc-500 font-black uppercase tracking-widest mt-1 sm:mt-0">{info.name}</div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>

                        {modals.folder && (
                            <div className="fixed inset-0 bg-slate-900/60 dark:bg-black/80 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
                                <div className="bg-white dark:bg-zinc-900 p-8 rounded-3xl w-full max-w-sm shadow-2xl animate-in zoom-in-95 border border-transparent dark:border-zinc-800">
                                    <h3 className="font-black text-xl mb-4">{editingFolder ? 'Editar Carpeta' : 'Nueva Carpeta'}</h3>
                                    <input value={folderForm.name} onChange={e => setFolderForm({...folderForm, name: e.target.value})} placeholder="Nombre..." className="w-full p-4 bg-slate-50 dark:bg-zinc-800 border border-slate-200 dark:border-zinc-700 rounded-2xl mb-4 font-bold outline-none focus:border-indigo-500 dark:focus:border-indigo-500 dark:text-white" autoFocus/>
                                    <div className="flex flex-wrap gap-2 mb-6 justify-center p-2">
                                        {FOLDER_PALETTE.map(c => (
                                            <button key={c} onClick={() => setFolderForm({...folderForm, colorClass: c})} className={`w-8 h-8 rounded-full border-2 transition-transform ${c.split(' ')[0]} ${folderForm.colorClass === c ? 'scale-125 border-stone-800 dark:border-white' : 'border-transparent'}`}></button>
                                        ))}
                                    </div>
                                    <div className="flex gap-2"><button onClick={() => setModals({...modals, folder: false})} className="flex-1 py-3 text-slate-400 dark:text-zinc-400 hover:bg-slate-50 dark:hover:bg-zinc-800 rounded-xl font-bold transition-colors">Cancelar</button><button onClick={saveFolder} className="flex-1 py-3 bg-indigo-600 dark:bg-indigo-500 text-white rounded-xl font-bold transition-colors">Guardar</button></div>
                                </div>
                            </div>
                        )}

                        {modals.activity && (
                            <div className="fixed inset-0 bg-slate-900/80 dark:bg-black/80 z-50 flex items-center justify-center p-4 backdrop-blur-md animate-in fade-in">
                                <div className="bg-white dark:bg-zinc-900 rounded-[2rem] w-full max-w-4xl max-h-[85vh] flex flex-col overflow-hidden shadow-2xl border border-transparent dark:border-zinc-800">
                                    <div className="p-6 border-b border-slate-100 dark:border-zinc-800 flex justify-between items-center bg-white dark:bg-zinc-900 sticky top-0 z-10 shrink-0">
                                        <div><h3 className="font-black text-2xl text-slate-800 dark:text-white tracking-tight">Crea o Selecciona</h3><p className="text-slate-400 dark:text-zinc-400 text-xs font-bold uppercase tracking-widest mt-1">Elige el motor para tu actividad</p></div>
                                        <button onClick={() => setModals({...modals, activity: false})} className="w-10 h-10 rounded-full bg-slate-50 dark:bg-zinc-800 hover:bg-rose-50 dark:hover:bg-rose-900/30 hover:text-rose-500 flex items-center justify-center transition-all text-slate-500 dark:text-zinc-400"><X size={20}/></button>
                                    </div>
                                    <div className="flex-1 overflow-y-auto p-4 md:p-8 bg-slate-50/50 dark:bg-zinc-950/50">
                                        <div className="mb-8">
                                            <h4 className="text-[10px] font-black text-slate-400 dark:text-zinc-500 uppercase tracking-[0.2em] mb-4">Generadores & Juegos</h4>
                                            <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                                                {GAME_TYPES.map(g => (
                                                    <button key={g.id} onClick={(e) => handleActivityClick(e, g)} className="bg-white dark:bg-zinc-800 p-5 rounded-[1.5rem] border border-slate-100 dark:border-zinc-700 hover:border-indigo-500 dark:hover:border-indigo-500 hover:shadow-xl transition-all text-left flex flex-row sm:flex-col items-center sm:items-start gap-4 group">
                                                        <div className={`w-12 h-12 ${g.color} text-white rounded-2xl flex items-center justify-center shadow-md group-hover:scale-110 transition-transform shrink-0`}><g.icon size={24}/></div>
                                                        <div><div className="font-black text-slate-700 dark:text-zinc-100 text-base sm:text-lg">{g.name}</div><div className="text-xs text-slate-400 dark:text-zinc-400 font-medium line-clamp-1">{g.desc}</div></div>
                                                    </button>
                                                ))}
                                            </div>
                                        </div>
                                        <div>
                                            <h4 className="text-[10px] font-black text-slate-400 dark:text-zinc-500 uppercase tracking-[0.2em] mb-4">Herramientas de Clase</h4>
                                            <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                                                {TOOL_TYPES.map(t => (
                                                    <a key={t.id} href={t.file} className="bg-slate-800 dark:bg-zinc-800 p-5 rounded-[1.5rem] border border-slate-700 dark:border-zinc-700 hover:shadow-xl transition-all text-left flex flex-row sm:flex-col items-center sm:items-start gap-4 group">
                                                        <div className="w-12 h-12 bg-white/10 text-white rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform shrink-0"><t.icon size={24}/></div>
                                                        <div><div className="font-black text-white text-base sm:text-lg">{t.name}</div><div className="text-xs text-slate-400 dark:text-zinc-400 font-medium line-clamp-1">{t.desc}</div></div>
                                                    </a>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<ErrorBoundary><Dashboard /></ErrorBoundary>);
    </script>
</body>
</html>
