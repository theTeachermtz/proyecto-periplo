<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connect 4 Game | Periplo</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŽ®</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "react/jsx-runtime": "https://esm.sh/react@18.2.0/jsx-runtime",
        "lucide-react": "https://esm.sh/lucide-react@0.263.1",
        "firebase/app": "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js",
        "firebase/firestore": "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"
      }
    }
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800;900&display=swap'); 
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f8fafc; overflow: hidden; }
        .token-drop { animation: drop 0.5s cubic-bezier(0.25, 1, 0.5, 1); }
        @keyframes drop { from { transform: translateY(-500px); } to { transform: translateY(0); } }
        .animate-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .info-scroll::-webkit-scrollbar { width: 8px; }
        .info-scroll::-webkit-scrollbar-track { background: #f1f5f9; }
        .info-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; border: 2px solid #f1f5f9; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { initializeApp } from 'firebase/app';
        import { getFirestore, doc, getDoc } from 'firebase/firestore';
        import { Trophy, HelpCircle, Brain, Mic, CheckCircle2, XCircle, ArrowRight, LogOut, Loader2, Info, X, SkipForward, RotateCcw, Database, Timer } from 'lucide-react';

        const firebaseConfig = { apiKey: "AIzaSyD4d-Kx1jQbgrKIdeOftv7BM729m7MIGPo", authDomain: "proyecto-periplo.firebaseapp.com", projectId: "proyecto-periplo", storageBucket: "proyecto-periplo.firebasestorage.app", messagingSenderId: "236795998392", appId: "1:236795998392:web:0da24b4f018611b55c844d" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const shuffleArray = (array) => {
            if (!array) return [];
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [newArray[i], newArray[j]] = [newArray[j], newArray[i]]; }
            return newArray;
        };

        const fireConfetti = () => { confetti({ particleCount: 150, spread: 80, origin: { y: 0.6 }, colors: ['#22c55e', '#3b82f6', '#f59e0b', '#ef4444'] }); };

        const CountdownBar = ({ duration, onTimeUp, isActive }) => {
            const [timeLeft, setTimeLeft] = useState(duration);
            useEffect(() => { if (!isActive) return; if (timeLeft <= 0) { onTimeUp(); return; } const timerId = setInterval(() => setTimeLeft(t => t - 1), 1000); return () => clearInterval(timerId); }, [timeLeft, isActive, onTimeUp]);
            const percentage = (timeLeft / duration) * 100;
            let color = 'bg-green-500';
            let animation = '';
            if (timeLeft <= 15) { color = 'bg-red-500'; animation = 'animate-pulse'; } 
            else if (timeLeft <= 30) color = 'bg-yellow-400';
            return <div className="w-full bg-slate-200 h-3 rounded-t-[2.5rem] overflow-hidden relative"><div className={`h-full ${color} ${animation} transition-all duration-1000 ease-linear`} style={{ width: `${percentage}%` }}></div></div>;
        };

        const StartScreen = ({ onStart, title }) => (
            <div className="fixed inset-0 bg-slate-900 z-50 flex flex-col items-center justify-center p-4 animate-in">
                <div className="text-center mb-12"><h1 className="text-5xl md:text-7xl font-black text-white mb-4 tracking-tight uppercase drop-shadow-lg">{title || 'Connect 4'}</h1><div className="inline-block bg-slate-800 px-6 py-2 rounded-full border border-slate-700"><p className="text-blue-400 font-bold uppercase tracking-[0.2em] text-sm">Selecciona Jugador Inicial</p></div></div>
                <div className="flex gap-8 md:gap-16"><button onClick={() => onStart('red')} className="w-48 h-48 md:w-64 md:h-64 bg-slate-800 rounded-[2.5rem] shadow-2xl hover:bg-slate-700 hover:-translate-y-2 transition-all border-4 border-slate-700 hover:border-red-500 flex flex-col items-center justify-center gap-6 group"><div className="w-20 h-20 md:w-24 md:h-24 rounded-full bg-red-500 shadow-[0_0_30px_rgba(239,68,68,0.4)] group-hover:scale-110 transition-transform border-4 border-red-600"></div><span className="font-black text-white text-xl md:text-2xl tracking-widest group-hover:text-red-400">ROJO</span></button><button onClick={() => onStart('yellow')} className="w-48 h-48 md:w-64 md:h-64 bg-slate-800 rounded-[2.5rem] shadow-2xl hover:bg-slate-700 hover:-translate-y-2 transition-all border-4 border-slate-700 hover:border-yellow-400 flex flex-col items-center justify-center gap-6 group"><div className="w-20 h-20 md:w-24 md:h-24 rounded-full bg-yellow-400 shadow-[0_0_30px_rgba(250,204,21,0.4)] group-hover:scale-110 transition-transform border-4 border-yellow-500"></div><span className="font-black text-white text-xl md:text-2xl tracking-widest group-hover:text-yellow-400">AMARILLO</span></button></div>
            </div>
        );

        const ContentInspector = ({ content, onClose }) => {
            const [tab, setTab] = useState('quizzes');
            return (
                <div className="fixed inset-0 bg-slate-900/95 z-50 flex items-center justify-center p-6 backdrop-blur-sm animate-in">
                    <div className="bg-white w-full max-w-4xl h-[85vh] rounded-[2.5rem] overflow-hidden shadow-2xl flex flex-col">
                        <div className="p-6 bg-slate-50 border-b border-slate-200 flex justify-between items-center"><div><h2 className="text-2xl font-black text-slate-800 flex items-center
